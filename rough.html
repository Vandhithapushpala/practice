<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <style>
      .hi{
        background-color:darksalmon;
      }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
  </head>
  <body onload="connectMetamask(),connectContract()">
    <nav  class="navbar bg-primary" bg-body-tertiary>
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Buyer</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="man1.html">Vendor1</a>
          </li>
        </ul>
        </div>
      </div>
      </nav>
    
    
    <!-- <button onclick="connectMetamask()">CONNECT TO METAMASK</button> <br> -->
	<p id="accountArea">Connection Status: NOT CONNECTED to Metamask </p>

	<!-- <button onclick="connectContract()">CONNECT TO CONTRACT</button> <br> -->
	<p id="contractArea">Connection Status: NOT CONNECTED to Smart Contract</p>


	
    <!-- <input type="text" id="inputArea">  -->

    <script>
        let account;
        const connectMetamask = async () => {
            if(window.ethereum !== "undefined"){
                const accounts = await ethereum.request({method: "eth_requestAccounts"});
                account = accounts[0];
                document.getElementById("accountArea").innerHTML = `Account is: ${account}`;
            }

        }

        const connectContract = async () => {
            const ABI =[
          {
            "inputs": [
          {
            "internalType": "uint256",
            "name": "a",
            "type": "uint256"
          }
        ],
        "name": "addprice",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "string[][]",
            "name": "a",
            "type": "string[][]"
          }
        ],
        "name": "save",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "name": "arr",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "get_pairs",
        "outputs": [
          {
            "internalType": "string[][]",
            "name": "",
            "type": "string[][]"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "name": "key_val_pairs",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "showprice",
        "outputs": [
          {
            "internalType": "uint256[]",
            "name": "",
            "type": "uint256[]"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ]
            const Address = "0x3A0E2Ff1437404bD93E2d52469f28E75cc2eCbDD";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address);
            document.getElementById("contractArea").innerHTML = "Connection Status: Success";
        }

        // const readWord = async () => {
        //     const data = await window.contract.methods.getFlower().call();
        //     document.getElementById("dataArea").innerHTML = `Word is: ${data}`;
        // }

        const changeWord = async () => {
            // const myEntry = document.getElementById("inputArea").value;
            if(n==0){
              await window.contract.methods.save(data).send({ from: account });
              n+=1;
            }
            else{
              alert("noooo");
            }
            
        }
        let s=0;
        const readWord = async () => {
      str="";
      
      const ABI =[
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "a",
				"type": "uint256"
			}
		],
		"name": "addprice",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string[][]",
				"name": "a",
				"type": "string[][]"
			}
		],
		"name": "save",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "arr",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_pairs",
		"outputs": [
			{
				"internalType": "string[][]",
				"name": "",
				"type": "string[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "key_val_pairs",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "showprice",
		"outputs": [
			{
				"internalType": "uint256[]",
				"name": "",
				"type": "uint256[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
            const Address = "0x3A0E2Ff1437404bD93E2d52469f28E75cc2eCbDD";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address);
      const d = await window.contract.methods.showprice().call();
      console.log(d);
      if(s==0){
        for(let i=0;i<d.length;i++){

          str+=`<tr><td><p>vendor ${i}</p></td><td>${d[i]}</td></tr>`;
        }
        document.getElementById("1").innerHTML+=str;
        
      }
      s+=1;
  }
    </script>
    <button id="Add">Click to add textbox</button>
    <!-- <button id="Remove">Click to remove textbox</button> -->
    <button id="see">Submit</button>
    <div id="textboxDiv"></div>
    <script>
      var n=0;
      var data = []; // initialize 2D array
      let i=0;
      $(document).ready(function () {
        $('#Add').on('click', function () {
          
          $('#textboxDiv').append(
            `<div class="wrapper"><span class="inline"><input type="text" id="${i}"/><input type="number" id="${i}1"/></span></div>`
          );
          i++;
        });
        // $('#Remove').on('click', function () {
        //   data.pop(); // remove last element from 2D array
        //   $('#textboxDiv').children().last().remove();
        // });
        $('#see').on('click',function(){
          if(n==0){
            for(let j=0;j<i;j++){
                    textValue = document.getElementById(`${j}`).value; // get text input value
                    numValue =  document.getElementById(`${j}1`).value;  // get number input value
                    var newData = [textValue, numValue]; // create new data array
                    data.push(newData); // add new data array to 2D array
                    console.log(data);
            }
          }
          else{
            alert("are you sure these are the items");
          }
          
        })
      });
      

    </script>
    <button onclick="changeWord()" class="hi">CHANGE DATA ON THE SMART CONTRACT</button> <br>
    <br>
    
    <!-- <button onclick="readWord()" class="hi">ACCEPTED REQUESTS</button> <br> -->
    <table class="table" id="1">
       
          
      <!-- <th scope="row">1</th>
      <td>Mark</td>
      <td>Otto</td>
      <td>@mdo</td> -->
  </tbody><button onclick="readContract()">Check Requests</button>
  <table id="myTable" class="table table-striped">
    <thead>
      <tr>
        <th>VENDOR</th>
        <th>PRICE</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Vendor1</td>
        <td>
          <p id="dataArea"></p>
        </td>
      </tr>
    </tbody>
  </table>
  <script>
    const readContract = async () => {
          var table = document.getElementById("myTable");
          table.style.display = "table";
          const da = await window.contract.methods.showprice().call();
          document.getElementById("dataArea").innerHTML = da[da.length-1];
      }
  </script>
</table>
    
  </body>
</html>
